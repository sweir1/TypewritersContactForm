<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Contact Form</title>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/gh/sweir1/TypewritersContactForm@master/styles/styles.css" />
		<script src="https://cdn.jsdelivr.net/gh/sweir1/TypewritersContactForm@master/scripts/emailValidator.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/sweir1/TypewritersContactForm@master/scripts/phoneValidator.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/sweir1/TypewritersContactForm@master/scripts/dropdownHandler.js"></script>
		<script src="https://www.google.com/recaptcha/api.js?render=6Le2l9UpAAAAAAqPCVBq6hdumV0KR79KO0UPyQLR"></script>
	</head>
	<body>
		<form id="newForm" class="uui-contact03_form">
			<div class="uui-form-field-wrapper">
				<label for="name" class="uui-field-label">Name</label>
				<input type="text" id="name" name="name" required class="uui-form_input-3 w-input" />
			</div>
			<div class="uui-form-field-wrapper">
				<label for="jobtitle" class="uui-field-label">Job title</label>
				<input type="text" id="jobtitle" name="jobtitle" required class="uui-form_input-3 w-input" />
			</div>
			<div class="uui-form-field-wrapper">
				<label for="email" class="uui-field-label">Business email</label>
				<input type="email" id="email" name="email" required class="uui-form_input-3 w-input" />
				<p id="emailError" style="display: none; color: red; font-size: 0.8em; margin-top: 4px">
					Please enter a valid business email.
				</p>
			</div>
			<div class="uui-form-field-wrapper">
				<label for="phone" class="uui-field-label">Phone number</label>
				<input type="tel" id="phone" name="phone" required class="uui-form_input-3 w-input" placeholder="" />
				<p id="phoneError" style="display: none; color: red; font-size: 0.8em; margin-top: 4px">
					Please enter a valid phone number.
				</p>
			</div>
			<div class="uui-form-field-wrapper">
				<label for="website" class="uui-field-label">Company website</label>
				<input
					type="text"
					id="website"
					name="website"
					required
					pattern="^(https?:\/\/)?([\w-]+\.)+[\w-]+(\/[\w-]*)*$"
					class="uui-form_input-3 w-input"
					placeholder="typewriters.io" />
			</div>
			<!-- Company Size -->
			<div class="uui-form-field-wrapper">
				<label for="company-size-trigger" class="uui-field-label">Company size</label>
				<select id="company_size" name="company_size" required class="uui-form_select-3 w-select" tabindex="-1">
					<option value="">Select company size</option>
					<option value="1-10">1-10 employees</option>
					<option value="11-50">11-50 employees</option>
					<option value="51-200">51-200 employees</option>
					<option value="201-500">201-500 employees</option>
					<option value="501+">501+ employees</option>
				</select>
				<div class="custom-select-container">
					<div
						id="company-size-trigger"
						class="custom-select-trigger"
						role="combobox"
						aria-label="Company size"
						tabindex="0">
						Select company size
					</div>
					<div class="custom-options" role="listbox">
						<div class="custom-option" data-value="1-10" role="option">1-10 employees</div>
						<div class="custom-option" data-value="11-50" role="option">11-50 employees</div>
						<div class="custom-option" data-value="51-200" role="option">51-200 employees</div>
						<div class="custom-option" data-value="201-500" role="option">201-500 employees</div>
						<div class="custom-option" data-value="501+" role="option">501+ employees</div>
					</div>
				</div>
			</div>

			<!-- Budget -->
			<div class="uui-form-field-wrapper">
				<label for="budget-trigger" class="uui-field-label">Available monthly budget</label>
				<select id="budget" name="budget" required class="uui-form_select-3 w-select" tabindex="-1">
					<option value="">Select budget</option>
					<option value="0-5000">$0 - $5,000</option>
					<option value="5001-10000">$5,001 - $10,000</option>
					<option value="10001-20000">$10,001 - $20,000</option>
					<option value="20001+">$20,001+</option>
				</select>
				<div class="custom-select-container">
					<div
						id="budget-trigger"
						class="custom-select-trigger"
						role="combobox"
						aria-label="Available monthly budget"
						tabindex="0">
						Select budget
					</div>
					<div class="custom-options" role="listbox">
						<div class="custom-option" data-value="0-5000" role="option">$0 - $5,000</div>
						<div class="custom-option" data-value="5001-10000" role="option">$5,001 - $10,000</div>
						<div class="custom-option" data-value="10001-20000" role="option">$10,001 - $20,000</div>
						<div class="custom-option" data-value="20001+" role="option">$20,001+</div>
					</div>
				</div>
			</div>

			<!-- Interested In -->
			<div class="uui-form-field-wrapper">
				<label for="interested-in-trigger" class="uui-field-label">Interested in</label>
				<select
					id="interested_in"
					name="interested_in"
					required
					class="uui-form_select-3 w-select"
					tabindex="-1">
					<option value="">Select solution</option>
					<option value="email">Email Marketing</option>
					<option value="translations">Translations</option>
					<option value="localization">Website Localization</option>
					<option value="copywriting">Copywriting</option>
				</select>
				<div class="custom-select-container">
					<div
						id="interested-in-trigger"
						class="custom-select-trigger"
						role="combobox"
						aria-label="Interested in"
						tabindex="0">
						Select solution
					</div>
					<div class="custom-options" role="listbox">
						<div class="custom-option" data-value="email" role="option">Email Marketing</div>
						<div class="custom-option" data-value="translations" role="option">Translations</div>
						<div class="custom-option" data-value="localization" role="option">Website Localization</div>
						<div class="custom-option" data-value="copywriting" role="option">Copywriting</div>
					</div>
				</div>
			</div>

			<!-- Industry -->
			<div class="uui-form-field-wrapper">
				<label for="industry-trigger" class="uui-field-label">Industry</label>
				<select id="industry" name="industry" required class="uui-form_select-3 w-select" tabindex="-1">
					<option value="">Select industry</option>
					<option value="fashion">Fashion</option>
					<option value="ecommerce">Ecommerce</option>
					<option value="retail">Retail</option>
					<option value="beauty">Beauty</option>
					<option value="realestate">Real Estate</option>
					<option value="webdev">Web Development</option>
					<option value="apparel">Apparel/Niche</option>
					<option value="travel">Travel & Tourism</option>
				</select>
				<div class="custom-select-container">
					<div
						id="industry-trigger"
						class="custom-select-trigger"
						role="combobox"
						aria-label="Industry"
						tabindex="0">
						Select industry
					</div>
					<div class="custom-options" role="listbox">
						<div class="custom-option" data-value="fashion" role="option">Fashion</div>
						<div class="custom-option" data-value="ecommerce" role="option">Ecommerce</div>
						<div class="custom-option" data-value="retail" role="option">Retail</div>
						<div class="custom-option" data-value="beauty" role="option">Beauty</div>
						<div class="custom-option" data-value="realestate" role="option">Real Estate</div>
						<div class="custom-option" data-value="webdev" role="option">Web Development</div>
						<div class="custom-option" data-value="apparel" role="option">Apparel/Niche</div>
						<div class="custom-option" data-value="travel" role="option">Travel & Tourism</div>
					</div>
				</div>
			</div>
			<div class="privacy-consent-container">
				<input type="checkbox" class="privacy-consent-checkbox" id="privacy-consent-checkbox" required />
				<label class="privacy-consent-label" style="margin-bottom: 0px" for="privacy-consent-checkbox"
					>You agree to our <a href="/privacy-policy" class="privacy-consent-link">privacy policy</a>.</label
				>
			</div>
			<div class="uui-form-button-wrapper">
				<button type="submit" class="custom-submit-button" id="submit-button">Continue</button>
			</div>
		</form>
		<script>
			document.addEventListener("DOMContentLoaded", function () {
				const form = document.getElementById("newForm");
				const emailInput = document.getElementById("email");
				const emailError = document.getElementById("emailError");
				const phoneInput = document.getElementById("phone");
				const phoneError = document.getElementById("phoneError");
				const selectContainers = document.querySelectorAll(".custom-select-container");
				const privacyCheckbox = document.getElementById("privacy-consent-checkbox");

				// Initialize existing functionality
				window.dropdownHandler.initializeCustomDropdowns(selectContainers);
				window.phoneValidator.formatPhoneNumber(phoneInput);

				// Add warm-up functionality
				privacyCheckbox.addEventListener("change", function () {
					// Warm up recaptcha verification
					fetch("https://subtle-phoenix-a52fad.netlify.app/.netlify/functions/verify-recaptcha", {
						mode: "no-cors",
					}).catch((error) => {
						// Silently catch and ignore the error
					});

					// Warm up email function
					fetch("https://subtle-phoenix-a52fad.netlify.app/.netlify/functions/send-email", {
						mode: "no-cors",
					}).catch((error) => {
						// Silently catch and ignore the error
					});
				});

				// Form Validation Logic
				function validateForm() {
					let isValid = true;

					// Validate all required fields
					form.querySelectorAll("[required]").forEach(function (element) {
						if (!element.value.trim()) {
							isValid = false;
							element.style.borderColor = "red";
							// Also style the custom trigger if it's a select
							if (element.tagName === "SELECT") {
								const customTrigger = element.parentElement.querySelector(".custom-select-trigger");
								if (customTrigger) {
									customTrigger.style.borderColor = "red";
								}
							}
						} else {
							element.style.borderColor = "";
							if (element.tagName === "SELECT") {
								const customTrigger = element.parentElement.querySelector(".custom-select-trigger");
								if (customTrigger) {
									customTrigger.style.borderColor = "";
								}
							}
						}
					});

					// Email validation
					if (!window.emailValidator.validateEmail(emailInput.value)) {
						isValid = false;
						emailInput.style.borderColor = "red";
						emailError.style.display = "block";
					} else {
						emailInput.style.borderColor = "";
						emailError.style.display = "none";
					}

					// Website validation
					const websiteInput = document.getElementById("website");
					if (!websiteInput.value.includes(".")) {
						// Only check the website condition
						isValid = false;
						websiteInput.style.borderColor = "red";
					} else {
						websiteInput.style.borderColor = "";
					}

					// Phone validation
					if (!window.phoneValidator.validatePhoneNumber(phoneInput.value)) {
						isValid = false;
						phoneInput.style.borderColor = "red";
						phoneError.style.display = "block";
					} else {
						phoneInput.style.borderColor = "";
						phoneError.style.display = "none";
					}

					return isValid;
				}

				// Function to verify token with Netlify function
				async function verifyToken(token) {
					try {
						const response = await fetch(
							"https://subtle-phoenix-a52fad.netlify.app/.netlify/functions/verify-recaptcha",
							{
								method: "POST",
								headers: {
									"Content-Type": "application/json",
								},
								body: JSON.stringify({ token }),
							},
						);

						if (!response.ok) {
							throw new Error("Network response was not ok");
						}

						return await response.json();
					} catch (error) {
						throw new Error("Failed to verify reCAPTCHA");
					}
				}

				// Form submit handler
				form.addEventListener("submit", async function (event) {
					event.preventDefault();
					// First validate the form
					if (!validateForm()) {
						return;
					}
					try {
						// Execute reCAPTCHA
						await new Promise((resolve, reject) => {
							grecaptcha.ready(async function () {
								try {
									const token = await grecaptcha.execute("6Le2l9UpAAAAAAqPCVBq6hdumV0KR79KO0UPyQLR", {
										action: "submit",
									});
									// Verify the token
									const response = await verifyToken(token);
									if (response.success && response.score > 0.5) {
										// Open Calendly immediately after captcha verification
										window.open("https://calendly.com/typewriters/30min", "_blank");

										// Prepare form data
										const formData = {
											firstname: document.getElementById("name").value,
											jobtitle: document.getElementById("jobtitle").value,
											email: document.getElementById("email").value,
											phone: document.getElementById("phone").value,
											website: document.getElementById("website").value,
											company_size: document.getElementById("company_size").value,
											budget: document.getElementById("budget").value,
											interested_in: document.getElementById("interested_in").value,
											industry: document.getElementById("industry").value,
										};

										// Send email and wait for response
										const emailResponse = await fetch(
											"https://subtle-phoenix-a52fad.netlify.app/.netlify/functions/send-email",
											{
												method: "POST",
												headers: {
													"Content-Type": "application/json",
												},
												body: JSON.stringify(formData),
											},
										);

										if (!emailResponse.ok) {
											console.error("Failed to send email");
										}

										// Submit form after email is sent (regardless of email success)
										form.submit();
										resolve();
									} else {
										reject(new Error("Security check failed"));
									}
								} catch (error) {
									reject(error);
								}
							});
						});
					} catch (error) {
						console.error("Error:", error);
						if (error.message === "Security check failed") {
							alert("Security check failed. Please try again later.");
						} else {
							alert("There was an error submitting the form. Please try again.");
						}
					}
				});
			});
		</script>
	</body>
</html>
